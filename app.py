import streamlit as st
from google import genai
from google.genai import types
import os

# -----------------------------------------------------
# 1. API ì„¤ì • ë° ëª¨ë¸ ì´ˆê¸°í™”
# -----------------------------------------------------
# ìš”ì²­í•˜ì‹  í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥í–ˆìŠµë‹ˆë‹¤.
api_key = "AIzaSyAU1iwa-OFdgFyiookp8Rcwez6rlNXajm4"

if not api_key:
    # ì´ ë¶€ë¶„ì€ í‚¤ê°€ ì´ë¯¸ ì…ë ¥ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë¬´ì‹œë  ê²ƒì…ë‹ˆë‹¤.
    st.error("âš ï¸ API Keyê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
    st.stop()

# Gemini í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
client = genai.Client(api_key=api_key)
model_name = 'gemini-2.5-flash' # ë¹ ë¥´ê³  ê°€ì„±ë¹„ ì¢‹ì€ ëª¨ë¸ ì„ íƒ

# -----------------------------------------------------
# 2. í•µì‹¬ í”„ë¡¬í”„íŠ¸ (System Instruction) ì •ì˜ - ì›ë˜ ìš”ì²­ì‚¬í•­ ìœ ì§€
# -----------------------------------------------------
SYSTEM_INSTRUCTION = """
ë‹¹ì‹ ì€ ê³ ë“±í•™êµ 1í•™ë…„ ìˆ˜í•™ 'ëª…ì œ' ë‹¨ì›ì˜ ì „ë¬¸ íŠœí„°ì…ë‹ˆë‹¤.
ë‹¹ì‹ ì˜ ëª©í‘œëŠ” í•™ìƒì˜ ë…¼ë¦¬ì  ì‚¬ê³ ë ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
ë‹¹ì‹ ì€ í•™ìƒì´ ì›¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì…ë ¥í•œ ë‹¤ìŒ ì„¸ ê°€ì§€ ì •ë³´([í•™ìƒì˜ ì…ë ¥])ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì—„ê²©í•˜ê²Œ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.

[í•™ìƒì˜ ì…ë ¥ í˜•ì‹]
1. ëª…ì œ: [í•™ìƒì´ ì…ë ¥í•œ ëª…ì œ] (ì˜ˆ: ëª¨ë“  ìì—°ìˆ˜ xì— ëŒ€í•´ x^2 > x ì´ë‹¤.)
2. í•™ìƒì˜ íŒë‹¨: [ì°¸ / ê±°ì§“]
3. í•™ìƒì´ ìƒê°í•˜ëŠ” ì´ìœ /ê·¼ê±°/ë°˜ë¡€: [í•™ìƒì´ ì§ì ‘ ì‘ì„±í•œ ì´ìœ ]

[ë‹¹ì‹ ì˜ í”¼ë“œë°± ì›ì¹™]
1. **ì •í™•ì„± í™•ì¸**: ëª…ì œì˜ ì‹¤ì œ ì°¸/ê±°ì§“ ì—¬ë¶€ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤.
2. **íŒë‹¨ ì¼ì¹˜ ì—¬ë¶€ í”¼ë“œë°±**:
    * **ì°¸/ê±°ì§“ì´ ëª¨ë‘ ë§ë‹¤ë©´**: "ë…¼ë¦¬ì ìœ¼ë¡œ ì™„ë²½í•´ìš”!"ë¼ê³  ì¹­ì°¬í•˜ê³ , í•™ìƒì˜ ì´ìœ ë¥¼ ë³´ê°•í•˜ëŠ” ì¶”ê°€ ì„¤ëª…ì´ë‚˜ ë” ì¼ë°˜ì ì¸ ì¦ëª… ì›ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
    * **íŒë‹¨ì€ ë§ì•˜ìœ¼ë‚˜ ì´ìœ ê°€ ë¶€ì¡±/í‹€ë ¸ë‹¤ë©´**: "íŒë‹¨ì€ ë§ì§€ë§Œ, ê·¼ê±°ë¥¼ ì¢€ ë” ë³´ê°•í•´ì•¼ í•´ìš”."ë¼ê³  í•˜ë©° ì •í™•í•œ ë…¼ë¦¬ì  ê·¼ê±°ë¥¼ ì œì‹œí•©ë‹ˆë‹¤.
    * **íŒë‹¨ì´ í‹€ë ¸ë‹¤ë©´ (ê°€ì¥ ì¤‘ìš”)**: "ë‹¤ì‹œ ìƒê°í•´ ë³¼ ë¶€ë¶„ì´ ìˆì–´ìš”."ë¼ê³  ì•ˆë‚´í•˜ê³ , ì™œ í‹€ë ¸ëŠ”ì§€ ëª…í™•íˆ ì„¤ëª…í•©ë‹ˆë‹¤.
3. **ì˜¤ë¥˜ êµì • (ê°€ì¥ êµ¬ì²´ì ìœ¼ë¡œ)**:
    * **'ëª¨ë“ ' ëª…ì œê°€ ê±°ì§“ì¸ë° í•™ìƒì´ ì°¸ì´ë¼ê³  í–ˆë‹¤ë©´**: **ì •í™•í•œ 'ë°˜ë¡€'**ë¥¼ í•˜ë‚˜ ì œì‹œí•˜ë©°, ë°˜ë¡€ì˜ ì—­í• (ë”± í•˜ë‚˜ë§Œ ìˆì–´ë„ ê±°ì§“ì´ ë¨)ì„ ê°•ì¡°í•©ë‹ˆë‹¤.
    * **'ì–´ë–¤' ëª…ì œê°€ ì°¸ì¸ë° í•™ìƒì´ ê±°ì§“ì´ë¼ê³  í–ˆë‹¤ë©´**: ëª…ì œë¥¼ ì°¸ì´ ë˜ê²Œ í•˜ëŠ” **'ì°¸ì¸ ì˜ˆì‹œ'**ë¥¼ í•˜ë‚˜ ì œì‹œí•˜ë©°, 'ì–´ë–¤'ì˜ ì˜ë¯¸(í•˜ë‚˜ë¼ë„ ì°¸ì´ë©´ ì°¸ì´ ë¨)ë¥¼ ê°•ì¡°í•©ë‹ˆë‹¤.
4. **ë§ˆì§€ë§‰ ì§ˆë¬¸**: í•™ìƒì´ ë‹¤ìŒ ëª…ì œë¥¼ ì…ë ¥í•˜ë„ë¡ ìœ ë„í•˜ëŠ” ì§ˆë¬¸ì„ ë§ë¶™ì…ë‹ˆë‹¤.
"""

# -----------------------------------------------------
# 3. Streamlit ì›¹ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
# -----------------------------------------------------

st.set_page_config(page_title="ê³ 1 ëª…ì œ ë…¼ë¦¬ íŠœí„° ì±—ë´‡", layout="centered")
st.title("ğŸ‘¨â€ğŸ« ê³ 1 ëª…ì œ ë…¼ë¦¬ íŠœí„° ì±—ë´‡")
st.markdown("ëª…ì œë¥¼ ì…ë ¥í•˜ê³ , ë³¸ì¸ì˜ íŒë‹¨ê³¼ ì´ìœ ë¥¼ ì ì–´ **ì¦‰ê°ì ì¸ ë…¼ë¦¬ í”¼ë“œë°±**ì„ ë°›ì•„ë³´ì„¸ìš”.")

# í¼ ìƒì„± (ì¦‰ê°ì ì¸ ì‘ë‹µì„ ìœ„í•´ st.form ì‚¬ìš©)
with st.form(key='tutor_form'):
    # ì…ë ¥ í•„ë“œ
    user_proposition = st.text_input("1. ëª…ì œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”. (ì˜ˆ: ëª¨ë“  ìì—°ìˆ˜ xì— ëŒ€í•´ xÂ² > x ì´ë‹¤.)", key="prop_input")
    user_judgment = st.radio(
        "2. í•™ìƒì˜ íŒë‹¨ì€ ë¬´ì—‡ì¸ê°€ìš”?",
        ('ì°¸', 'ê±°ì§“'),
        index=None,
        key="judg_radio"
    )
    user_reason = st.text_area("3. ê·¸ë ‡ê²Œ íŒë‹¨í•œ ì´ìœ /ê·¼ê±°/ë°˜ë¡€ë¥¼ ì¨ì£¼ì„¸ìš”. (êµ¬ì²´ì ì¼ìˆ˜ë¡ ì¢‹ì•„ìš”!)", key="reason_input")
    
    # ì œì¶œ ë²„íŠ¼
    submit_button = st.form_submit_button(label='í”¼ë“œë°± ìš”ì²­í•˜ê¸°')

# ì œì¶œ ë²„íŠ¼ì´ ëˆŒë ¸ì„ ë•Œ ë¡œì§
if submit_button:
    # ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬
    if not user_proposition or not user_judgment or not user_reason:
        st.error("ëª¨ë“  í•­ëª©(ëª…ì œ, íŒë‹¨, ì´ìœ )ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.")
        st.stop()
        
    # AIì— ì „ë‹¬í•  ìµœì¢… ì‚¬ìš©ì ì…ë ¥ ë©”ì‹œì§€ êµ¬ì„±
    user_message = f"""
    [í•™ìƒì˜ ì…ë ¥]
    1. ëª…ì œ: {user_proposition}
    2. í•™ìƒì˜ íŒë‹¨: {user_judgment}
    3. í•™ìƒì´ ìƒê°í•˜ëŠ” ì´ìœ /ê·¼ê±°/ë°˜ë¡€: {user_reason}
    
    ìœ„ ì…ë ¥ì— ëŒ€í•´ ì—„ê²©í•œ í”¼ë“œë°± ì›ì¹™ì„ ë”°ë¼ ë…¼ë¦¬ì ì¸ íŠœí„°ë§ í”¼ë“œë°±ì„ ì œê³µí•´ ì£¼ì„¸ìš”.
    """
    
    # ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ (í”¼ë“œë°±ì´ ì˜¤ëŠ” ë™ì•ˆ)
    with st.spinner('âœ¨ AI íŠœí„°ê°€ ë…¼ë¦¬ë¥¼ ë¶„ì„í•˜ê³  í”¼ë“œë°±ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...'):
        try:
            # Gemini API í˜¸ì¶œ
            response = client.models.generate_content(
                model=model_name,
                contents=user_message,
                config=types.GenerateContentConfig(
                    system_instruction=SYSTEM_INSTRUCTION
                )
            )
            
            # ê²°ê³¼ í‘œì‹œ
            st.success("ğŸ‰ í”¼ë“œë°±ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤!")
            st.markdown(response.text)
            
        except Exception as e:
            st.error(f"API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í‚¤ ì„¤ì •ì„ í™•ì¸í•˜ê±°ë‚˜, ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”. (ì˜¤ë¥˜: {e})")